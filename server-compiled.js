(()=>{var e={440:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});const n=a(167),o=a(689),s=function(e){const[t,a]=o.useState(!1),[s,i]=o.useState(""),[r,l]=o.useState(),[c,d]=o.useState("");return o.createElement("div",{className:"card"},o.createElement("div",{className:"our-card-top"},t&&o.createElement("div",{className:"our-custom-input"},o.createElement("div",{className:"our-custom-input-interior"},o.createElement("input",{onChange:e=>l(e.target.files[0]),className:"form-control form-control-sm",type:"file"}))),o.createElement("img",{src:e.photo?`/uploaded-photos/${e.photo}`:"/fallback.png",className:"card-img-top",alt:`${e.species} named ${e.name}`})),o.createElement("div",{className:"card-body"},!t&&o.createElement(o.Fragment,null,o.createElement("h4",null,e.name),o.createElement("p",{className:"text-muted small"},e.species),!e.readOnly&&o.createElement(o.Fragment,null,o.createElement("button",{onClick:()=>{a(!0),i(e.name),d(e.species),l("")},className:"btn btn-sm btn-primary"},"Edit")," ",o.createElement("button",{onClick:async()=>{n.delete(`/animal/${e.id}`),e.setAnimals((t=>t.filter((t=>t._id!=e.id))))},className:"btn btn-sm btn-outline-danger"},"Delete"))),t&&o.createElement("form",{onSubmit:async function(t){t.preventDefault(),a(!1),e.setAnimals((t=>t.map((function(t){return t._id==e.id?{...t,name:s,species:c}:t}))));const o=new FormData;r&&o.append("photo",r),o.append("_id",e.id),o.append("name",s),o.append("species",c);const i=await n.post("/update-animal",o,{headers:{"Content-Type":"multipart/form-data"}});i.data&&e.setAnimals((t=>t.map((function(t){return t._id==e.id?{...t,photo:i.data}:t}))))}},o.createElement("div",{className:"mb-1"},o.createElement("input",{autoFocus:!0,onChange:e=>i(e.target.value),type:"text",className:"form-control form-control-sm",value:s})),o.createElement("div",{className:"mb-2"},o.createElement("input",{onChange:e=>d(e.target.value),type:"text",className:"form-control form-control-sm",value:c})),o.createElement("button",{className:"btn btn-sm btn-success"},"Save")," ",o.createElement("button",{onClick:()=>a(!1),className:"btn btn-sm btn-outline-secondary"},"Cancel"))))}},167:e=>{"use strict";e.exports=require("axios")},860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},738:e=>{"use strict";e.exports=require("multer")},689:e=>{"use strict";e.exports=require("react")},684:e=>{"use strict";e.exports=require("react-dom/server")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")},17:e=>{"use strict";e.exports=require("path")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const{MongoClient:e,ObjectId:t}=a(13),n=a(860),o=a(738)(),s=a(109),i=a(470),r=a(441);let l;const c=a(17);a(689),a(684),a(440),i.ensureDirSync(c.join("public","uploaded-photos"));const d=n();function m(e,t,a){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.species&&(e.body.species=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:s(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),species:s(e.body.species.trim(),{allowedTags:[],allowedAttributes:{}})},a()}d.set("view engine","ejs"),d.set("views","./views"),d.use(n.static("public")),d.use(n.json()),d.use(n.urlencoded({extended:!1})),d.get("/",(async(e,t)=>{await l.collection("animals").find().toArray()})),d.use((function(e,t,a){t.set("WWW-Authenticate","Basic realm='Our MERN App'"),"Basic YWRtaW46YWRtaW4="==e.headers.authorization?a():(console.log(e.headers.authorization),t.status(401).send("Try again"))})),d.get("/admin",((e,t)=>{t.render("admin")})),d.get("/api/animals",(async(e,t)=>{const a=await l.collection("animals").find().toArray();t.json(a)})),d.post("/create-animal",o.single("photo"),m,(async(e,a)=>{if(e.file){const t=`${Date.now()}.jpg`;await r(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(c.join("public","uploaded-photos",t)),e.cleanData.photo=t}console.log(e.body);const n=await l.collection("animals").insertOne(e.cleanData),o=await l.collection("animals").findOne({_id:new t(n.insertedId)});a.send(o)})),d.delete("/animal/:id",(async(e,a)=>{"string"!=typeof e.params.id&&(e.params.id="");const n=await l.collection("animals").findOne({_id:new t(e.params.id)});n.photo&&i.remove(c.join("public","uploaded-photos",n.photo)),l.collection("animals").deleteOne({_id:new t(e.params.id)}),a.send("Good job")})),d.post("/update-animal",o.single("photo"),m,(async(e,a)=>{if(e.file){const n=`${Date.now()}.jpg`;await r(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(c.join("public","uploaded-photos",n)),e.cleanData.photo=n;const o=await l.collection("animals").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData});o.value.photo&&i.remove(c.join("public","uploaded-photos",o.value.photo)),a.send(n)}else l.collection("animals").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData}),a.send(!1)})),async function(){const t=new e("mongodb://root:root@localhost:27017/AmazingMernApp?&authSource=admin");await t.connect(),l=t.db(),d.listen(3e3)}()})()})();